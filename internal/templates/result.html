<h1 class="text-2xl font-bold">üì¶ –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–≥—Ä—É–∑–∫–∏</h1>

{{if .Error}}
<p class="text-red-600 text-lg">{{.Error}}</p>
{{else}}
<div id="progressWrap" class="space-y-3">
  <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
    <div id="bar" class="bg-blue-500 h-3" style="width:0%"></div>
  </div>
  <div class="text-sm text-gray-600">
    <span id="status">–ò–¥—ë—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞‚Ä¶</span>
    <span id="percent" class="font-semibold ml-2">0%</span>
  </div>
</div>

<div id="ready" class="hidden mt-4">
  <a id="dl" class="inline-block px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition" href="#"
    download>‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å</a>
</div>

<script>
  (function () {
    const jobId = "{{.JobID}}";
    if (!jobId) return;

    const bar = document.getElementById('bar');
    const percent = document.getElementById('percent');
    const status = document.getElementById('status');
    const ready = document.getElementById('ready');
    const dl = document.getElementById('dl');

    async function tick() {
      try {
        const r = await fetch('/progress?id=' + encodeURIComponent(jobId), { cache: 'no-cache' });
        if (!r.ok) throw new Error('HTTP ' + r.status);
        const j = await r.json();

        if (typeof j.percent === 'number') {
          const p = Math.max(0, Math.min(100, j.percent));
          bar.style.width = p + '%';
          percent.textContent = Math.round(p) + '%';
        }

        status.textContent = ({
          queued: '–í –æ—á–µ—Ä–µ–¥–∏‚Ä¶',
          running: '–ò–¥—ë—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞‚Ä¶',
          done: '–ì–æ—Ç–æ–≤–æ!',
          error: '–û—à–∏–±–∫–∞'
        })[j.status] || '‚Ä¶';

        if (j.status === 'done' && j.file_name) {
          ready.classList.remove('hidden');
          dl.href = '/downloads/' + encodeURIComponent(j.file_name);
          return; // —Å—Ç–æ–ø –æ–ø—Ä–æ—Å
        }
        if (j.status === 'error') {
          status.textContent = j.error || '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏';
          bar.style.width = '0%';
          return;
        }
      } catch (e) {
        // –º–æ–ª—á–∞ –ø–æ–¥–æ–∂–¥—ë–º –∏ –ø–æ–ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞
      }
      setTimeout(tick, 1500);
    }
    tick();
  })();
</script>
{{end}}